<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAWAN BISA - SIDOARJO</title>
    
    <!-- Menggunakan Tailwind CSS untuk styling modern -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Menggunakan Google Fonts untuk tipografi yang bersih -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Menggunakan Heroicons untuk ikon -->
    <script src="https://unpkg.com/heroicons@2.1.3/24/outline/index.js"></script>

    <!-- Menambahkan library Leaflet.js untuk Peta -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <style>
        /* Style kustom untuk aplikasi */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Memberi efek scroll yang halus */
        .smooth-scroll {
            scroll-behavior: smooth;
        }
        /* Kustomisasi scrollbar agar lebih modern */
        .chat-window::-webkit-scrollbar {
            width: 6px;
        }
        .chat-window::-webkit-scrollbar-track {
            background: #f1f5f9; /* bg-slate-100 */
        }
        .chat-window::-webkit-scrollbar-thumb {
            background: #cbd5e1; /* bg-slate-300 */
            border-radius: 3px;
        }
        .chat-window::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; /* bg-slate-400 */
        }
        .tab-icon-active {
            color: #3b82f6; /* blue-500 */
        }
        /* Style untuk container peta */
        #map {
            height: 300px;
            border-radius: 0.5rem;
        }
        .bot-response ul {
            list-style-type: disc;
            margin-left: 20px;
            margin-top: 8px;
        }
        .bot-response li {
            margin-bottom: 4px;
        }
    </style>
</head>
<body class="bg-slate-100 text-gray-800">

    <!-- Kontainer utama aplikasi, dibuat menyerupai tampilan mobile -->
    <div class="max-w-md mx-auto h-screen flex flex-col bg-slate-100 shadow-2xl">

        <!-- Header Aplikasi -->
        <header class="bg-white/80 backdrop-blur-sm p-4 border-b border-slate-200 z-10">
            <div class="flex justify-between items-center">
                <!-- PERUBAHAN: Logo PSI di Kiri -->
                <div class="w-1/4 flex justify-start">
                    <a href="https://www.instagram.com/dpdpsisidoarjo/" target="_blank" rel="noopener noreferrer" class="transition-transform duration-200 hover:scale-110" title="Kunjungi Instagram PSI Sidoarjo">
                        <img src="logo-psi.png" alt="Logo PSI" class="w-11 h-11 rounded-full">
                    </a>
                </div>
                <!-- Tengah: Judul -->
                <div class="w-1/2 text-center">
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-500 to-red-500 bg-clip-text text-transparent">KAWAN BISA</h1>
                    <p class="text-xs text-gray-500 mt-1">Kolaborasi PSI DPD SIDOARJO X BNN SIDOARJO</p>
                    <p id="datetime" class="text-[10px] text-gray-400 mt-1"></p>
                </div>
                <!-- PERUBAHAN: Logo BNN di Kanan -->
                <div class="w-1/4 flex justify-end">
                     <a href="https://www.instagram.com/infobnn_kab_sidoarjo/?hl=en" target="_blank" rel="noopener noreferrer" class="transition-transform duration-200 hover:scale-110" title="Kunjungi Instagram BNN Sidoarjo">
                        <img src="logo-bnn.png" alt="Logo BNN" class="w-11 h-11 rounded-full">
                    </a>
                </div>
            </div>
        </header>

        <!-- Konten Utama (dapat diganti sesuai tab) -->
        <main class="flex-grow overflow-y-auto p-4 pb-20">
            
            <!-- KONTEN 1: CHATBOT (Default) -->
            <div id="chat-content" class="h-full flex flex-col">
                <div id="chat-window" class="flex-grow space-y-4 overflow-y-auto smooth-scroll chat-window pr-2">
                    <div class="flex items-start gap-3">
                        <div class="bg-red-500 text-white p-2 rounded-full">
                           <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a2.25 2.25 0 0 0 2.25-2.25V8.25a2.25 2.25 0 0 0-2.25-2.25H6.75A2.25 2.25 0 0 0 4.5 8.25v10.5A2.25 2.25 0 0 0 6.75 21Z" /></svg>
                        </div>
                        <div>
                            <div class="bg-white rounded-lg rounded-tl-none p-3 shadow-sm">
                                <p class="text-sm">Hai! Aku KAWAN BISA. Pilih topik di bawah atau ketik pertanyaanmu untuk memulai.</p>
                            </div>
                            <!-- Tombol aksi cepat yang lengkap -->
                            <div id="quick-actions" class="mt-2 flex flex-wrap gap-2">
                                <button onclick="sendQuickAction('Apa itu Narkoba?')" class="text-xs bg-slate-200 hover:bg-slate-300 text-slate-700 px-3 py-1 rounded-full transition">Apa itu Narkoba?</button>
                                <button onclick="sendQuickAction('Jenis-jenis Narkoba')" class="text-xs bg-slate-200 hover:bg-slate-300 text-slate-700 px-3 py-1 rounded-full transition">Jenis-jenis</button>
                                <button onclick="sendQuickAction('Ciri-ciri pengguna')" class="text-xs bg-slate-200 hover:bg-slate-300 text-slate-700 px-3 py-1 rounded-full transition">Ciri Pengguna</button>
                                <button onclick="sendQuickAction('Efek samping Narkoba')" class="text-xs bg-slate-200 hover:bg-slate-300 text-slate-700 px-3 py-1 rounded-full transition">Efek Samping</button>
                                <button onclick="sendQuickAction('Durasi efek Narkoba')" class="text-xs bg-slate-200 hover:bg-slate-300 text-slate-700 px-3 py-1 rounded-full transition">Durasi Efek</button>
                                <button onclick="sendQuickAction('Efek sosial Narkoba')" class="text-xs bg-slate-200 hover:bg-slate-300 text-slate-700 px-3 py-1 rounded-full transition">Efek Sosial</button>
                                <button onclick="sendQuickAction('Info hukum Narkoba')" class="text-xs bg-slate-200 hover:bg-slate-300 text-slate-700 px-3 py-1 rounded-full transition">Info Hukum</button>
                                <button onclick="sendQuickAction('Proses rehabilitasi')" class="text-xs bg-slate-200 hover:bg-slate-300 text-slate-700 px-3 py-1 rounded-full transition">Proses Rehab</button>
                                <button onclick="sendQuickAction('Strategi berhenti')" class="text-xs bg-slate-200 hover:bg-slate-300 text-slate-700 px-3 py-1 rounded-full transition">Strategi Berhenti</button>
                                <button onclick="sendQuickAction('Cara menghindari ajakan')" class="text-xs bg-slate-200 hover:bg-slate-300 text-slate-700 px-3 py-1 rounded-full transition">Cara Menghindari</button>
                                <button onclick="sendQuickAction('Kegiatan positif')" class="text-xs bg-slate-200 hover:bg-slate-300 text-slate-700 px-3 py-1 rounded-full transition">Kegiatan Positif</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-4 flex items-center gap-2">
                    <input type="text" id="chat-input" class="flex-grow bg-white border border-slate-300 rounded-full py-2 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ketik pesanmu di sini...">
                    <button onclick="sendMessage()" class="bg-blue-500 hover:bg-blue-600 text-white p-3 rounded-full transition shadow-md hover:shadow-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" /></svg>
                    </button>
                </div>
            </div>

            <!-- KONTEN 2: PETA RISIKO & POTENSI -->
            <div id="peta-content" class="hidden">
                <h2 class="text-lg font-semibold mb-4">Peta Risiko & Potensi Sidoarjo</h2>
                <div class="bg-white rounded-lg p-4 shadow-md">
                    <div id="map" class="mb-4 bg-slate-200"></div>
                    <p class="text-sm text-gray-600 mb-4">Peta ini menunjukkan lokasi-lokasi kegiatan positif dan area yang memerlukan perhatian khusus di Sidoarjo. Data bersifat ilustratif.</p>
                    <div class="flex justify-around">
                        <div class="flex items-center gap-2"><div class="w-4 h-4 bg-green-500 rounded-full border border-white"></div><span class="text-xs">Zona Potensi Positif</span></div>
                        <div class="flex items-center gap-2"><div class="w-4 h-4 bg-yellow-500 rounded-full border border-white"></div><span class="text-xs">Zona Perhatian</span></div>
                    </div>
                </div>
            </div>

            <!-- KONTEN 3: LAPOR ANONIM -->
            <div id="lapor-content" class="hidden">
                <h2 class="text-lg font-semibold mb-4">Lapor Cepat</h2>
                <div class="bg-white rounded-lg p-4 shadow-md">
                    <p class="text-sm text-gray-600 mb-4">Lihat aktivitas mencurigakan? Laporkan di sini. Laporan Anda akan diteruskan ke pihak berwenang.</p>
                    <form id="lapor-form" class="space-y-4">
                        <div><label for="lapor-nama" class="block text-sm font-medium text-gray-700">Nama Pelapor</label><input type="text" id="lapor-nama" class="w-full mt-1 bg-slate-100 border border-slate-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Nama Anda (opsional)"></div>
                        <div><label for="lapor-telepon" class="block text-sm font-medium text-gray-700">No. Telepon</label><input type="tel" id="lapor-telepon" class="w-full mt-1 bg-slate-100 border border-slate-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Nomor yang bisa dihubungi (opsional)"></div>
                        <div><label for="lapor-alamat" class="block text-sm font-medium text-gray-700">Alamat Pelapor</label><input type="text" id="lapor-alamat" class="w-full mt-1 bg-slate-100 border border-slate-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Alamat Anda (opsional)"></div>
                        <div><label for="lapor-deskripsi" class="block text-sm font-medium text-gray-700">Deskripsi Kejadian</label><textarea id="lapor-deskripsi" rows="4" class="w-full mt-1 bg-slate-100 border border-slate-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Jelaskan apa yang kamu lihat..." required></textarea></div>
                        <div><label for="lapor-lokasi" class="block text-sm font-medium text-gray-700">Perkiraan Lokasi Kejadian</label><input type="text" id="lapor-lokasi" class="w-full mt-1 bg-slate-100 border border-slate-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Contoh: Dekat Alun-Alun Sidoarjo" required></div>
                        <button type="button" onclick="kirimLaporan()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition shadow-md hover:shadow-lg">Kirim Laporan via Email</button>
                    </form>
                </div>
            </div>
            
            <!-- KONTEN 4: BANTUAN & KLINIK DIGITAL -->
            <div id="bantuan-content" class="hidden">
                <h2 class="text-lg font-semibold mb-4">Bantuan & Informasi Sidoarjo</h2>
                <div class="mb-6"><p class="text-center text-sm text-gray-600 mb-2">Butuh bantuan segera? Hubungi Hotline BNN.</p><a href="tel:123-456-789" class="block w-full text-center bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg transition animate-pulse shadow-lg">TOMBOL DARURAT</a></div>
                
                <!-- PERUBAHAN ALAMAT DAN KONTAK -->
                <div class="space-y-4">
                    <div><h3 class="font-semibold mb-2 text-red-500">Kantor DPD PSI Sidoarjo</h3><div class="bg-white rounded-lg p-4 text-sm shadow-md"><p>Jl. Cemeng Bakalan No.184 11, RW.02, Cemeng, Cemeng Bakalan, Kec. Sidoarjo, Kabupaten Sidoarjo, Jawa Timur 61234</p><p class="mt-2 font-semibold">Kontak: 0823-3543-3354 (Sekretariat)</p></div></div>
                    <div><h3 class="font-semibold mb-2 text-blue-500">Kantor BNN Kabupaten Sidoarjo</h3><div class="bg-white rounded-lg p-4 text-sm shadow-md"><p>Jalan Perum Taman Pinang, Blok AA8, Nomor 1A, Kwadengan Barat, Lemahputro, Kec. Sidoarjo, Kabupaten Sidoarjo, Jawa Timur 61213</p></div></div>
                </div>

                <!-- PERUBAHAN BARU: LBH -->
                <h3 class="font-semibold mt-6 mb-3">Lembaga Bantuan Hukum (LBH)</h3>
                <div class="space-y-3">
                    <div class="bg-white rounded-lg p-4 shadow-md"><h4 class="font-semibold text-blue-500">LBH Sidoarjo</h4><p class="text-sm text-gray-600 mt-1">Menyediakan konsultasi dan pendampingan hukum. (Alamat & kontak perlu diverifikasi lebih lanjut)</p></div>
                </div>

                <h3 class="font-semibold mt-6 mb-3">Klinik & Layanan Rehabilitasi</h3>
                <div class="space-y-3">
                    <div class="bg-white rounded-lg p-4 shadow-md"><h4 class="font-semibold text-blue-500">Klinik Pratama BNN Sidoarjo</h4><p class="text-sm text-gray-600 mt-1">Jl. Perum Taman Pinang Blok AA8, No. 1A, Sidoarjo</p></div>
                    <div class="bg-white rounded-lg p-4 shadow-md"><h4 class="font-semibold text-blue-500">RSUD Sidoarjo</h4><p class="text-sm text-gray-600 mt-1">Menyediakan layanan rehabilitasi medis.</p></div>
                </div>
            </div>
        </main>

        <!-- Navigasi Bawah (Tab Bar) -->
        <footer class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white/80 backdrop-blur-sm border-t border-slate-200">
            <nav class="flex justify-around p-2">
                <button id="tab-chat" onclick="showTab('chat')" class="tab-button flex flex-col items-center text-gray-500 hover:text-blue-500 transition tab-icon-active"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 0 1-2.555-.337A5.972 5.972 0 0 1 5.41 20.97a5.969 5.969 0 0 1-.474-.065 4.48 4.48 0 0 0 .978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25Z" /></svg><span class="text-xs mt-1">Chat</span></button>
                <button id="tab-peta" onclick="showTab('peta')" class="tab-button flex flex-col items-center text-gray-500 hover:text-blue-500 transition"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M9 6.75V15m6-6v8.25m.5-10.5h-7a2.25 2.25 0 0 0-2.25 2.25v10.5a2.25 2.25 0 0 0 2.25 2.25h7.5a2.25 2.25 0 0 0 2.25-2.25V8.25a2.25 2.25 0 0 0-2.25-2.25H15M3 12h3m12 0h3" /></svg><span class="text-xs mt-1">Peta</span></button>
                <button id="tab-lapor" onclick="showTab('lapor')" class="tab-button flex flex-col items-center text-gray-500 hover:text-blue-500 transition"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" /></svg><span class="text-xs mt-1">Lapor</span></button>
                <button id="tab-bantuan" onclick="showTab('bantuan')" class="tab-button flex flex-col items-center text-gray-500 hover:text-blue-500 transition"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" /></svg><span class="text-xs mt-1">Bantuan</span></button>
            </nav>
        </footer>
    </div>
    
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg p-6 max-w-sm w-full text-center shadow-xl">
            <p id="modal-message" class="text-gray-800 mb-4"></p>
            <button onclick="closeModal()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition">Tutup</button>
        </div>
    </div>

    <script>
        const modal = document.getElementById('modal');
        const modalMessage = document.getElementById('modal-message');
        function showModal(message) { modalMessage.textContent = message; modal.classList.remove('hidden'); }
        function closeModal() { modal.classList.add('hidden'); }

        const tabs = ['chat', 'peta', 'lapor', 'bantuan'];
        const tabButtons = {};
        const tabContents = {};
        let mapInitialized = false;

        tabs.forEach(tab => {
            tabButtons[tab] = document.getElementById(`tab-${tab}`);
            tabContents[tab] = document.getElementById(`${tab}-content`);
        });

        function showTab(tabName) {
            tabs.forEach(tab => {
                tabContents[tab].classList.add('hidden');
                tabButtons[tab].classList.remove('tab-icon-active');
            });
            tabContents[tabName].classList.remove('hidden');
            tabButtons[tabName].classList.add('tab-icon-active');
            if (tabName === 'peta' && !mapInitialized) { initMap(); mapInitialized = true; }
        }

        function initMap() {
            // PERUBAHAN PETA: Koordinat Sidoarjo
            const sidoarjoCoords = [-7.4478, 112.7183];
            const map = L.map('map').setView(sidoarjoCoords, 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors' }).addTo(map);
            const yellowIcon = new L.Icon({ iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-yellow.png', shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png', iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41] });
            const greenIcon = new L.Icon({ iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png', shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png', iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41] });
            
            // PERUBAHAN PETA: Contoh marker di Sidoarjo
            L.marker([-7.455, 112.715], {icon: yellowIcon}).addTo(map).bindPopup('<b>Contoh Zona Perhatian</b><br>Area ini memerlukan kewaspadaan bersama.');
            L.marker([-7.444, 112.720], {icon: greenIcon}).addTo(map).bindPopup('<b>Alun-Alun Sidoarjo</b><br>Pusat kegiatan positif dan komunitas.');
            L.marker([-7.430, 112.710], {icon: greenIcon}).addTo(map).bindPopup('<b>GOR Delta Sidoarjo</b><br>Area untuk kegiatan olahraga.');
        }

        function kirimLaporan() {
            const nama = document.getElementById('lapor-nama').value;
            const telepon = document.getElementById('lapor-telepon').value;
            const alamat = document.getElementById('lapor-alamat').value;
            const deskripsi = document.getElementById('lapor-deskripsi').value;
            const lokasi = document.getElementById('lapor-lokasi').value;
            if (!deskripsi || !lokasi) { showModal('Deskripsi kejadian dan lokasi kejadian wajib diisi.'); return; }
            const subject = encodeURIComponent('Laporan Cepat dari Aplikasi KAWAN BISA');
            const body = encodeURIComponent(`Laporan Baru:\n\nNama Pelapor: ${nama || 'Tidak diisi'}\nNo. Telepon: ${telepon || 'Tidak diisi'}\nAlamat Pelapor: ${alamat || 'Tidak diisi'}\n\n-----------------------------------\nLOKASI KEJADIAN:\n${lokasi}\n\nDESKRIPSI KEJADIAN:\n${deskripsi}`);
            window.location.href = `mailto:aden.setyo91@gmail.com?subject=${subject}&body=${body}`;
            showModal('Anda akan diarahkan ke aplikasi email. Silakan kirim email tersebut.');
            document.getElementById('lapor-form').reset();
        }

        const chatWindow = document.getElementById('chat-window');
        const chatInput = document.getElementById('chat-input');
        chatInput.addEventListener('keypress', (e) => e.key === 'Enter' && sendMessage());

        function sendMessage() {
            const userInput = chatInput.value.trim();
            if (userInput === '') return;
            appendMessage(userInput, 'user');
            chatInput.value = '';
            showTypingIndicator();
            setTimeout(() => {
                hideTypingIndicator();
                const botResponse = getBotResponse(userInput);
                appendMessage(botResponse, 'bot');
            }, 1500 + Math.random() * 500);
        }
        
        function sendQuickAction(text) {
            appendMessage(text, 'user');
            showTypingIndicator();
            setTimeout(() => {
                hideTypingIndicator();
                const botResponse = getBotResponse(text);
                appendMessage(botResponse, 'bot');
            }, 1000);
        }

        function appendMessage(message, sender) {
            const messageElement = document.createElement('div');
            if (sender === 'user') {
                messageElement.className = 'flex justify-end';
                messageElement.innerHTML = `<div class="bg-blue-500 text-white rounded-lg rounded-br-none p-3 max-w-xs shadow"><p class="text-sm">${message}</p></div>`;
            } else {
                messageElement.className = 'flex items-start gap-3';
                messageElement.innerHTML = `<div class="bg-red-500 text-white p-2 rounded-full flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a2.25 2.25 0 0 0 2.25-2.25V8.25a2.25 2.25 0 0 0-2.25-2.25H6.75A2.25 2.25 0 0 0 4.5 8.25v10.5A2.25 2.25 0 0 0 6.75 21Z" /></svg></div><div class="bg-white rounded-lg rounded-tl-none p-3 max-w-xs bot-response shadow-sm"><div class="text-sm text-gray-800">${message}</div></div>`;
            }
            chatWindow.appendChild(messageElement);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function showTypingIndicator() {
            const typingElement = document.createElement('div');
            typingElement.id = 'typing-indicator';
            typingElement.className = 'flex items-start gap-3';
            typingElement.innerHTML = `<div class="bg-red-500 text-white p-2 rounded-full flex-shrink-0"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a2.25 2.25 0 0 0 2.25-2.25V8.25a2.25 2.25 0 0 0-2.25-2.25H6.75A2.25 2.25 0 0 0 4.5 8.25v10.5A2.25 2.25 0 0 0 6.75 21Z" /></svg></div><div><div class="bg-white rounded-lg rounded-tl-none p-3 max-w-xs shadow-sm"><div class="flex items-center gap-1"><span class="w-2 h-2 bg-slate-300 rounded-full animate-bounce" style="animation-delay: 0s;"></span><span class="w-2 h-2 bg-slate-300 rounded-full animate-bounce" style="animation-delay: 0.1s;"></span><span class="w-2 h-2 bg-slate-300 rounded-full animate-bounce" style="animation-delay: 0.2s;"></span></div></div></div>`;
            chatWindow.appendChild(typingElement);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) typingIndicator.remove();
        }

        // --- "MESIN" AI DENGAN PENGETAHUAN LENGKAP ---
        function getBotResponse(userInput) {
            const input = userInput.toLowerCase();
            const blue = "text-blue-600 font-semibold";
            const red = "text-red-600 font-semibold";

            if (input.includes('apa itu narkoba')) return `Narkoba adalah singkatan dari Narkotika, Psikotropika, dan Bahan Adiktif lainnya. Secara sederhana, ini adalah zat kimia, baik alami maupun buatan, yang jika dimasukkan ke dalam tubuh dapat mengubah pikiran, suasana hati, perasaan, dan perilaku seseorang. Penyalahgunaannya sangat berbahaya karena menyebabkan kecanduan dan merusak kesehatan fisik maupun mental.`;
            
            if (input.includes('jenis-jenis')) return `Narkotika digolongkan berdasarkan potensi ketergantungannya:<br><strong class="${red} mt-2 block">GOLONGAN I:</strong><ul><li>Sangat berbahaya, potensi ketergantungan sangat tinggi, dan <strong class="underline">dilarang untuk pengobatan.</strong></li><li>Contoh: Ganja, Heroin, Kokain, Sabu, Ekstasi.</li></ul><strong class="${blue} mt-2 block">GOLONGAN II:</strong><ul><li>Potensi ketergantungan tinggi, tapi <strong class="underline">bisa digunakan sebagai pilihan terakhir</strong> dalam terapi/pengobatan.</li><li>Contoh: Morfin, Petidin.</li></ul><strong class="text-green-600 font-semibold mt-2 block">GOLONGAN III:</strong><ul><li>Potensi ketergantungan ringan dan <strong class="underline">banyak digunakan</strong> dalam terapi/pengobatan.</li><li>Contoh: Kodein.</li></ul>`;
            
            if (input.includes('ciri-ciri')) return `Mengenali pengguna narkoba bisa dilihat dari perubahan fisik dan perilaku. <br><strong class="${blue} mt-2 block">Perubahan Fisik:</strong><ul><li>Mata merah atau sayu</li><li>Berat badan turun drastis</li><li>Sering mimisan (jika pakai hirup)</li><li>Luka bekas suntikan</li><li>Kurang peduli kebersihan diri</li></ul><strong class="${blue} mt-2 block">Perubahan Perilaku:</strong><ul><li>Sering bohong & mencuri</li><li>Menarik diri dari keluarga/teman</li><li>Prestasi sekolah/kerja menurun</li><li>Sering marah tanpa sebab jelas</li><li>Pola tidur berubah drastis</li></ul>Ingat, ini hanya indikasi. Jangan langsung menghakimi ya.`;

            if (input.includes('efek samping')) return `<strong class="${blue} block">Efek Samping Narkoba:</strong><ul><li><strong class="${red}">Ganja:</strong> Euforia sesaat, tapi diikuti panik, paranoid, gangguan memori, dan motivasi menurun.</li><li><strong class="${red}">Sabu:</strong> Sangat adiktif. Bikin super aktif tapi merusak otak, jantung, dan menyebabkan halusinasi parah (psikosis).</li><li><strong class="${red}">Ekstasi:</strong> Meningkatkan mood & energi, tapi setelahnya menyebabkan depresi berat, cemas, dan dehidrasi berbahaya.</li><li><strong class="${red}">Heroin:</strong> Sangat menenangkan tapi risiko overdosis dan kematian sangat tinggi. Merusak organ dalam secara masif.</li></ul>Semua jenis narkoba merusak masa depanmu.`;

            if (input.includes('durasi')) return `Durasi narkoba bertahan di tubuh tergantung jenisnya, frekuensi pakai, dan metabolisme tubuhmu. Ini perkiraannya:<br><strong class="${blue} mt-2 block">Deteksi di Tes Urin:</strong><ul><li><strong class="${red}">Ganja:</strong> 3-30 hari (bisa lebih lama untuk pengguna berat).</li><li><strong class="${red}">Sabu:</strong> 1-4 hari.</li><li><strong class="${red}">Ekstasi:</strong> 2-5 hari.</li></ul><strong class="${blue} mt-2 block">Bagaimana cara menghilangkannya?</strong><ul><li><strong class="${red}">STOP TOTAL!</strong> Ini langkah pertama dan terpenting.</li><li><strong class="${red}">Hidrasi:</strong> Minum banyak air putih untuk membantu proses pembuangan racun oleh ginjal.</li><li><strong class="${red}">Gaya Hidup Sehat:</strong> Makan makanan bergizi dan olahraga teratur untuk meningkatkan metabolisme.</li><li><strong class="${red}">Bantuan Profesional:</strong> Cara paling aman dan efektif adalah melalui proses detoksifikasi di bawah pengawasan medis. Tidak ada cara instan yang aman.</li></ul>`;

            if (input.includes('efek sosial')) return `Penyalahgunaan narkoba tidak hanya merusak diri sendiri, tapi juga lingkungan sosial. Ini beberapa efeknya:<br><ul><li><strong class="${red}">Hubungan Rusak:</strong> Pengguna sering berbohong dan memanipulasi, menyebabkan putusnya hubungan dengan keluarga dan teman.</li><li><strong class="${red}">Masalah Keuangan:</strong> Kecanduan membuat pengeluaran tak terkontrol, seringkali berujung pada utang dan tindakan kriminal seperti mencuri.</li><li><strong class="${red}">Kehilangan Masa Depan:</strong> Sulit fokus di sekolah atau pekerjaan, yang bisa berakibat putus sekolah atau dipecat.</li><li><strong class="${red}">Stigma Negatif:</strong> Masyarakat sering mengucilkan pengguna dan keluarganya, membuat mereka makin terisolasi.</li></ul>`;

            if (input.includes('hukum')) return `Hukuman diatur dalam UU No. 35/2009. Beratnya hukuman tergantung pada <strong class="${red}">GOLONGAN</strong> narkotika.<br><strong class="${blue} mt-2 block">Bagi PENGEDAR/PRODUSEN:</strong><ul><li><strong class="${red}">Golongan I (Pasal 114):</strong> Pidana mati, seumur hidup, atau penjara 6-20 tahun.</li><li><strong class="text-yellow-600 font-semibold">Golongan II (Pasal 112):</strong> Penjara 5-15 tahun.</li><li><strong class="text-green-600 font-semibold">Golongan III (Pasal 111):</strong> Penjara 4-12 tahun.</li></ul><strong class="${blue} mt-2 block">Bagi PENGGUNA/PECANDU (Pasal 127):</strong><ul><li><strong class="${red}">Golongan I:</strong> Maksimal 4 tahun penjara.</li><li><strong class="text-yellow-600 font-semibold">Golongan II:</strong> Maksimal 2 tahun penjara.</li><li><strong class="text-green-600 font-semibold">Golongan III:</strong> Maksimal 1 tahun penjara.</li></ul>Penting: Hakim dapat memutuskan untuk menempatkan pengguna dalam rehabilitasi medis dan sosial.`;

            if (input.includes('rehabilitasi')) return `Rehabilitasi adalah jalan pemulihan yang berani. Prosesnya biasanya:<br><strong class="${blue} mt-2 block">1. Tahap Awal (Detoksifikasi):</strong><ul><li>Proses penghentian total zat, biasanya di bawah pengawasan medis untuk mengatasi gejala putus zat (sakau). Ini tahap paling berat secara fisik.</li></ul><strong class="${blue} mt-2 block">2. Tahap Lanjutan (Non-medis):</strong><ul><li>Fokus pada pemulihan psikologis dan sosial. Meliputi konseling individu, terapi kelompok, dan pembinaan spiritual.</li><li>Untuk yang sudah <strong class="${red}">akut</strong>, biasanya butuh program rawat inap (residensial) yang lebih intensif.</li></ul>Kamu bisa mulai dengan konsultasi ke BNN atau klinik di menu 'Bantuan'.`;

            if (input.includes('strategi berhenti')) return `Berhenti dari narkoba adalah proses yang butuh tekad kuat. Ini langkah-langkahnya:<br><strong class="${blue} mt-2 block">1. Akui & Terima Masalah:</strong><ul><li>Langkah pertama adalah jujur pada diri sendiri bahwa kamu butuh bantuan.</li></ul><strong class="${blue} mt-2 block">2. Cari Bantuan Profesional:</strong><ul><li>Hubungi BNN, klinik, atau psikolog. Mereka akan membantumu melalui proses detoksifikasi dan rehabilitasi dengan aman. Jangan lakukan sendiri!</li></ul><strong class="${blue} mt-2 block">3. Ubah Lingkungan:</strong><ul><li>Ini krusial. Hapus kontak dan jauhi semua orang atau tempat yang berhubungan dengan narkoba.</li></ul><strong class="${blue} mt-2 block">4. Fokus pada Pemulihan:</strong><ul><li>Ikuti program rehabilitasi dengan serius. Belajar kelola stres dan cari kegiatan baru yang sehat untuk menggantikan kebiasaan lama.</li></ul>Setiap hari tanpa narkoba adalah sebuah kemenangan. Kamu bisa!`;

            if (input.includes('menghindari')) return `Menghindari narkoba adalah pilihan cerdas untuk masa depanmu. Ini caranya:<br><ul><li><strong class="${blue}">Perkuat Iman & Diri:</strong> Dekatkan diri pada Tuhan dan bangun kepercayaan diri. Kamu berharga!</li><li><strong class="${blue}">Pilih Teman yang Baik:</strong> Lingkungan pertemanan sangat berpengaruh. Jauhi teman yang mengajak ke hal negatif.</li><li><strong class="${blue}">Isi Waktu dengan Hobi:</strong> Sibukkan diri dengan olahraga, seni, musik, atau apa pun yang kamu sukai.</li><li><strong class="${blue}">Berani Berkata "TIDAK":</strong> Kamu punya hak untuk menolak ajakan yang merusak.</li><li><strong class="${blue}">Bicara dengan Keluarga:</strong> Jangan pendam masalahmu sendiri. Keluarga adalah support system terbaik.</li></ul>`;
            
            if (input.includes('kegiatan positif')) return `Mengisi waktu dengan hal positif adalah benteng terbaik melawan narkoba. Coba beberapa hal ini:<br><ul><li><strong class="${blue}">Olahraga:</strong> Gabung klub sepak bola, basket, voli, atau sekadar lari pagi. Olahraga melepaskan endorfin yang bikin bahagia alami.</li><li><strong class="${blue}">Seni & Kreativitas:</strong> Belajar main musik, menggambar, menulis puisi, atau ikut teater.</li><li><strong class="${blue}">Kegiatan Sosial/Relawan:</strong> Bantu di panti asuhan, ikut kegiatan karang taruna, atau gabung komunitas peduli lingkungan.</li><li><strong class="${blue}">Keagamaan:</strong> Aktif di kegiatan remaja masjid atau gereja bisa memberikan ketenangan dan lingkungan yang positif.</li></ul>Intinya, temukan passion-mu dan tekuni itu!`;
            
            return `Maaf, aku masih belajar. Aku belum mengerti pertanyaan itu. Coba gunakan salah satu tombol pilihan di atas untuk memulai.`;
        }
        
        function getFeeling(input) {
            if (input.includes('cemas')) return 'cemas';
            if (input.includes('stres')) return 'stres';
            if (input.includes('sedih')) return 'sedih';
            if (input.includes('kesepian')) return 'kesepian';
            return 'tidak baik-baik saja';
        }

        // Fungsi untuk menampilkan tanggal dan jam
        function updateDateTime() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
            document.getElementById('datetime').textContent = now.toLocaleDateString('id-ID', options) + ' WIB';
        }

        window.onload = () => { 
            showTab('chat'); 
            updateDateTime();
            setInterval(updateDateTime, 60000); // Update setiap menit
        };
    </script>

</body>
</html>
